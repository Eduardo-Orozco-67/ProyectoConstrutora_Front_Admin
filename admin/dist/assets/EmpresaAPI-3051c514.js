import{a as n}from"./axios-47b9d439.js";import{_ as g,a as l,b as k,c as v,d as r,e as a,w as d,g as V}from"./index-e9023bbb.js";const T={data(){return{apiData:[],eliminarDialogVisible:!1,editarDialogVisible:!1,nombreEmpresa:"",confirmacionEmpresa:null,empresaEdit:{nombre:"",direccion:"",telefono:"",correo:""},authToken:null}},created(){this.obtenerToken()},methods:{obtenerToken(){const e={username:"admin",password:"secretaacces123"};n.post("https://api-constructora.onrender.com/token",{username:e.username,password:e.password},{headers:{"Content-Type":"application/json"}}).then(o=>{console.log(o),this.authToken=o.data.access_token,n.defaults.headers.common.Authorization=`Bearer ${this.authToken}`,this.cargarEmpresas()}).catch(o=>{console.error("Error al obtener el token JWT",o),o.response&&console.error("Respuesta del servidor:",o.response.data)})},cargarEmpresas(){this.authToken&&n.get(`https://api-constructora.onrender.com/empresa/ver-todas?jsonwebtoken=${this.authToken}`).then(e=>{this.apiData=e.data}).catch(e=>{console.error("Error al obtener los datos de la API",e)})},cargarDatosProtegidos(){n.get(`https://api-constructora.onrender.com/protected-route?jsonwebtoken=${this.authToken}`).then(e=>{console.log("Datos de la ruta protegida:",e.data)}).catch(e=>{console.error("Error al cargar datos de la ruta protegida",e)})},confirmarEliminacion(e){this.eliminarDialogVisible=!0,this.confirmacionEmpresa=e},eliminarEmpresa(){this.confirmacionEmpresa&&this.authToken&&n.delete(`https://api-constructora.onrender.com/empresa/delete/${this.confirmacionEmpresa.nombre}?jsonwebtoken=${this.authToken}`).then(e=>{e.status===200&&(this.cargarEmpresas(),this.mostrarNotificacion("Eliminación exitosa","La empresa ha sido eliminada con éxito.","success"))}).catch(e=>{console.error("Error al eliminar la empresa",e),this.mostrarNotificacion("Error","No se pudo eliminar la empresa.","error")}),this.eliminarDialogVisible=!1},mostrarNotificacion(e,o,u){this.$refs.toast.add({severity:u,summary:e,detail:o,life:5e3})},buscarEmpresaPorNombre(){this.nombreEmpresa&&this.authToken?n.get(`https://api-constructora.onrender.com/empresa/ver1/${this.nombreEmpresa}?jsonwebtoken=${this.authToken}`).then(e=>{this.apiData=[e.data],this.mostrarNotificacion("Empresa encontrada!","Empresa encontrada con éxito.","success")}).catch(e=>{console.error("Error al buscar empresa por nombre",e),this.mostrarNotificacion("Error","No se pudo encontrar la empresa.","error")}):this.mostrarNotificacion("Advertencia","Ingrese un nombre de empresa para buscar.","warn")},editarEmpresa(e){this.empresaEdit={...e},this.editarDialogVisible=!0},cancelarEdicion(){this.editarDialogVisible=!1,this.empresaEdit={nombre:"",direccion:"",telefono:"",correo:""}},guardarEdicion(){this.empresaEdit&&this.authToken&&n.put(`https://api-constructora.onrender.com/empresa/update/${this.empresaEdit.nombre}?jsonwebtoken=${this.authToken}`,this.empresaEdit).then(e=>{e.status===200&&(this.cargarEmpresas(),this.editarDialogVisible=!1,this.mostrarNotificacion("Actualización exitosa","La empresa ha sido actualizada con éxito.","success"))}).catch(e=>{console.error("Error al actualizar la empresa",e),this.mostrarNotificacion("Error","No se pudo actualizar la empresa.","error")})}}},D={class:"p-grid"},C={class:"p-col-12"},x={class:"card"},N={class:"p-grid"},w={class:"p-col-12 p-md-6"},j=r("div",null," ¿Estás seguro de que deseas eliminar esta empresa? ",-1),P={class:"p-d-flex p-jc-end"},y={class:"p-grid"},B={class:"p-col-12"},z={class:"p-fluid"},A={class:"p-field"},I=r("label",{for:"edit-nombre"},"Nombre",-1),U=r("br",null,null,-1),L={class:"p-field"},H=r("label",{for:"edit-direccion"},"Dirección",-1),R=r("br",null,null,-1),q={class:"p-field"},G=r("label",{for:"edit-telefono"},"Teléfono",-1),J=r("br",null,null,-1),O={class:"p-field"},W=r("label",{for:"edit-correo"},"Correo",-1),F=r("br",null,null,-1),K={class:"p-d-flex p-jc-end"};function M(e,o,u,Q,s,c){const m=l("InputText"),t=l("Button"),b=l("Panel"),p=l("Column"),f=l("DataTable"),h=l("Dialog"),_=l("Toast");return k(),v("div",null,[r("div",D,[r("div",C,[r("div",x,[a(b,{header:"Registro de empresas",style:{height:"100%"}},{default:d(()=>[r("div",N,[r("div",w,[a(m,{type:"text",placeholder:"Nombre de la empresa",modelValue:s.nombreEmpresa,"onUpdate:modelValue":o[0]||(o[0]=i=>s.nombreEmpresa=i)},null,8,["modelValue"]),a(t,{label:"Buscar",icon:"pi pi-search",onClick:c.buscarEmpresaPorNombre},null,8,["onClick"])])])]),_:1}),a(f,{value:s.apiData,paginator:!0,rows:5,rowsPerPageOptions:[5,10,25],responsiveLayout:"scroll"},{default:d(()=>[a(p,{field:"nombre",header:"Nombre",sortable:!0}),a(p,{field:"direccion",header:"Dirección",sortable:!0}),a(p,{field:"telefono",header:"Teléfono",sortable:!0}),a(p,{field:"correo",header:"Correo",sortable:!0}),a(p,{style:{width:"150px"}},{header:d(()=>[V(" Editar/eliminar registro ")]),body:d(i=>[a(t,{icon:"pi pi-pencil",class:"p-button-success p-mr-2",onClick:E=>c.editarEmpresa(i.data)},null,8,["onClick"]),a(t,{icon:"pi pi-trash",class:"p-button-danger",onClick:E=>c.confirmarEliminacion(i.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])])])]),a(h,{header:"Confirmar eliminación",visible:s.eliminarDialogVisible,onHide:o[2]||(o[2]=i=>s.eliminarDialogVisible=!1)},{default:d(()=>[j,r("div",P,[a(t,{label:"Cancelar",class:"p-button-text",onClick:o[1]||(o[1]=i=>s.eliminarDialogVisible=!1)}),a(t,{label:"Eliminar",class:"p-button-danger",onClick:c.eliminarEmpresa},null,8,["onClick"])])]),_:1},8,["visible"]),a(h,{header:"Editar empresa",visible:s.editarDialogVisible,onHide:o[7]||(o[7]=i=>s.editarDialogVisible=!1)},{default:d(()=>[r("div",null,[r("div",y,[r("div",B,[r("div",z,[r("div",A,[I,a(m,{id:"edit-nombre",modelValue:s.empresaEdit.nombre,"onUpdate:modelValue":o[3]||(o[3]=i=>s.empresaEdit.nombre=i),readonly:""},null,8,["modelValue"])]),U,r("div",L,[H,a(m,{id:"edit-direccion",modelValue:s.empresaEdit.direccion,"onUpdate:modelValue":o[4]||(o[4]=i=>s.empresaEdit.direccion=i)},null,8,["modelValue"])]),R,r("div",q,[G,a(m,{id:"edit-telefono",modelValue:s.empresaEdit.telefono,"onUpdate:modelValue":o[5]||(o[5]=i=>s.empresaEdit.telefono=i)},null,8,["modelValue"])]),J,r("div",O,[W,a(m,{id:"edit-correo",modelValue:s.empresaEdit.correo,"onUpdate:modelValue":o[6]||(o[6]=i=>s.empresaEdit.correo=i)},null,8,["modelValue"])]),F])])]),r("div",K,[a(t,{label:"Cancelar",class:"p-button-text",onClick:c.cancelarEdicion},null,8,["onClick"]),a(t,{label:"Guardar",class:"p-button-success",onClick:c.guardarEdicion},null,8,["onClick"])])])]),_:1},8,["visible"]),a(_,{ref:"toast"},null,512)])}const Y=g(T,[["render",M]]);export{Y as default};
