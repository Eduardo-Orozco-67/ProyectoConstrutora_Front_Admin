import{a as r}from"./axios-47b9d439.js";import{_ as p,a,b as f,c as h,d as s,e as l,j as _}from"./index-e9023bbb.js";const D={data(){return{formData:{folio_solicitud:null,id_solicitud:null,descripcion:"",costo:0},folio_solicitudOptions:[],id_solicitudOptions:[],authToken:null}},created(){this.obtenerToken(),this.cargarFolio()},methods:{obtenerToken(){const t={username:"admin",password:"secretaacces123"};r.post("https://api-constructora.onrender.com/token",{username:t.username,password:t.password},{headers:{"Content-Type":"application/json"}}).then(o=>{this.authToken=o.data.access_token,r.defaults.headers.common.Authorization=`Bearer ${this.authToken}`,this.cargarFolio()}).catch(o=>{console.error("Error al obtener el token JWT",o),o.response&&console.error("Respuesta del servidor:",o.response.data)})},cargarFolio(){this.authToken&&r.get(`https://api-constructora.onrender.com/solicitud_proyecto/ver-todas?jsonwebtoken=${this.authToken}`).then(t=>{this.folio_solicitudOptions=t.data.map(o=>o.folio_solicitud),this.id_solicitudOptions=t.data.map(o=>o.id_solicitud)}).catch(t=>{console.error("Error al obtener los datos de la API",t)})},submitForm(){if(console.log("Submit button clicked"),this.validateFields()){const t=`https://api-constructora.onrender.com/detalle_solicitud/create/?folio_solicitud=${this.formData.folio_solicitud}&jsonwebtoken=${this.authToken}`;r.post(t,{id_solicitud:this.formData.id_solicitud,descripcion:this.formData.descripcion,costo:this.formData.costo}).then(o=>{o.status===200&&(this.showSuccessToast("¡Detalle de solicitud registrado exitosamente!"),this.limpiarCamposEntrada())}).catch(o=>{console.error("Error al registrar detalle de solicitud",o),this.showApiErrorToast(o)})}},validateFields(){return this.formData.folio_solicitud!==null&&this.formData.id_solicitud!==null&&this.formData.descripcion.trim()!==""&&this.formData.costo>=0?!0:(this.showValidationError("Por favor, complete todos los campos correctamente."),!1)},showSuccessToast(t){this.$refs.toast.add({severity:"success",summary:"Éxito",detail:t,life:3e3})},showApiErrorToast(t){t.response&&(t.response.status===422?errorMessage="Error de validacion":errorMessage="Ya existe la solicitud"),this.$refs.toast.add({severity:"error",summary:"Error",detail:errorMessage,life:5e3})},showValidationError(t){this.$refs.toast.add({severity:"error",summary:"Error de validación",detail:t,life:5e3})},limpiarCamposEntrada(){this.formData.costo="",this.formData.descripcion="",this.formData.folio_solicitud=null,this.formData.id_solicitud=null}}},b=s("h1",null,"Registrar detalle de solicitud",-1),v={class:"col-6 md:6"},T={class:"card p-fluid"},k={class:"field col-9 md-6"},w=s("label",{for:"folio_solicitud"},"Folio de solicitud:",-1),V={class:"field col-9 md-6"},g=s("label",{for:"id_solicitud"},"ID Solicitud:",-1),E={class:"field col-9 md-6"},y=s("label",{for:"descripcion"},"Descripcion:",-1),x={class:"field col-9 md-6"},C=s("label",{for:"costo"},"Costo:",-1),F={class:"field col-4 md-3"};function B(t,o,O,S,i,d){const c=a("Dropdown"),n=a("InputText"),u=a("Button"),m=a("Toast");return f(),h("div",null,[b,s("form",{onSubmit:o[4]||(o[4]=_((...e)=>d.submitForm&&d.submitForm(...e),["prevent"])),class:"grid"},[s("div",v,[s("div",T,[s("div",k,[w,l(c,{id:"folio_solicitud",modelValue:i.formData.folio_solicitud,"onUpdate:modelValue":o[0]||(o[0]=e=>i.formData.folio_solicitud=e),options:i.folio_solicitudOptions,showClear:"",placeholder:"Folio de la solicitud",required:""},null,8,["modelValue","options"])]),s("div",V,[g,l(c,{id:"id_solicitud",modelValue:i.formData.id_solicitud,"onUpdate:modelValue":o[1]||(o[1]=e=>i.formData.id_solicitud=e),options:i.id_solicitudOptions,showClear:"",placeholder:"Identificador de la solicitud",required:""},null,8,["modelValue","options"])]),s("div",E,[y,l(n,{id:"descripcion",type:"Text",modelValue:i.formData.descripcion,"onUpdate:modelValue":o[2]||(o[2]=e=>i.formData.descripcion=e),placeholder:"Descripcion del detalle",required:""},null,8,["modelValue"])]),s("div",x,[C,l(n,{id:"costo",type:"number",modelValue:i.formData.costo,"onUpdate:modelValue":o[3]||(o[3]=e=>i.formData.costo=e),placeholder:"Costo de la solicitud",required:""},null,8,["modelValue"])]),s("div",F,[l(u,{label:"Registrar",class:"p-button-success mr-2 mb-2",type:"submit"})])])])],32),l(m,{ref:"toast"},null,512)])}const q=p(D,[["render",B]]);export{q as default};
