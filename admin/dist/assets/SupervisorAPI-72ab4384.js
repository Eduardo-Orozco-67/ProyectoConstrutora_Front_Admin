import{a}from"./axios-47b9d439.js";import{_ as b,a as l,b as S,c as E,d as r,e as s,w as p,g}from"./index-e9023bbb.js";const V={data(){return{supervisores:[],eliminarDialogVisible:!1,editarDialogVisible:!1,telefono_supervisor:"",correo_supervisor:"",confirmacionSupervisor:null,supervisorEdit:{nombre:"",cargo:"",telefono:"",correo:""},authToken:null}},created(){this.obtenerToken()},methods:{obtenerToken(){const o={username:"admin",password:"secretaacces123"};a.post("https://api-constructora.onrender.com/token",{username:o.username,password:o.password},{headers:{"Content-Type":"application/json"}}).then(e=>{this.authToken=e.data.access_token,a.defaults.headers.common.Authorization=`Bearer ${this.authToken}`,this.cargarSupervisores()}).catch(e=>{console.error("Error al obtener el token JWT",e),e.response&&console.error("Respuesta del servidor:",e.response.data)})},cargarSupervisores(){this.authToken&&a.get(`https://api-constructora.onrender.com/supervisor/ver-todos/?jsonwebtoken=${this.authToken}`).then(o=>{this.supervisores=o.data}).catch(o=>{console.error("Error al obtener los datos de la API",o)})},confirmarEliminacionSupervisor(o){this.eliminarDialogVisible=!0,this.confirmacionSupervisor=o},eliminarSupervisor(){if(this.confirmacionSupervisor){const o=`https://api-constructora.onrender.com/supervisor/delete/${this.confirmacionSupervisor.telefono}/${this.confirmacionSupervisor.correo}?jsonwebtoken=${this.authToken}`;a.delete(o).then(e=>{e.status===200&&(this.cargarSupervisores(),this.mostrarNotificacion("Eliminación exitosa","El supervisor ha sido eliminado con éxito.","success"))}).catch(e=>{console.error("Error al eliminar el supervisor",e),this.mostrarNotificacion("Error","No se pudo eliminar el supervisor.","error")})}this.eliminarDialogVisible=!1},buscarSupervisorPorTelefonoYCorreo(){if(this.telefono_supervisor||this.correo_supervisor){const o=`https://api-constructora.onrender.com/supervisor/ver1/${this.telefono_supervisor}/${this.correo_supervisor}?jsonwebtoken=${this.authToken}`;a.get(o).then(e=>{this.supervisores=[e.data],this.showSuccessToastSupervisor("Supervisor encontrado!","Supervisor encontrado con éxito.","success")}).catch(e=>{console.error("Error al buscar Supervisor",e),this.showValidationErrorSupervisor("Error","No se pudo encontrar el Supervisor.","error")})}else this.showWarnToastSupervisor("Complete los campos de busqueda","verifique los campos de entrada.","warn")},editarSupervisor(o){this.supervisorEdit={...o},this.editarDialogVisible=!0},guardarEdicionSupervisor(){const o=`https://api-constructora.onrender.com/supervisor/update/${this.supervisorEdit.telefono}/${this.supervisorEdit.correo}?jsonwebtoken=${this.authToken}`;a.put(o,this.supervisorEdit).then(e=>{e.status===200&&(this.cargarSupervisores(),this.showSuccessEditSupervisor())}).catch(e=>{console.error("Error al editar el supervisor",e),this.showErrorEditSupervisor()}),this.editarDialogVisible=!1},cancelarEdicionSupervisor(){this.editarDialogVisible=!1,this.supervisorEdit={nombre:"",cargo:"",telefono:"",correo:""}},showSuccessEditSupervisor(){this.showSuccessToastSupervisor("El supervisor ha sido editado con éxito.")},showErrorEditSupervisor(){this.showErrorToastSupervisor("No se pudo editar el supervisor.")},showSuccessToastSupervisor(o){this.$refs.toast.add({severity:"success",summary:"Éxito",detail:o,life:3e3})},showValidationErrorSupervisor(o){this.$refs.toast.add({severity:"error",summary:"Error de validación",detail:o,life:5e3})},showWarnToastSupervisor(o){this.$refs.toast.add({severity:"warn",summary:"Aviso",detail:o,life:5e3})}}},w={class:"p-grid"},T={class:"p-col-12"},k={class:"card"},C={class:"p-grid"},y={class:"p-col-12 p-md-8"},x={class:"p-grid"},D={class:"p-col-12"},N={class:"p-fluid"},B={class:"p-field"},P=r("label",{for:"edit-nombre"},"Nombre",-1),j=r("br",null,null,-1),U={class:"p-field"},A=r("label",{for:"edit-cargo"},"Cargo",-1),I=r("br",null,null,-1),W={class:"p-field"},q=r("label",{for:"edit-telefono"},"Teléfono",-1),Y=r("br",null,null,-1),z={class:"p-field"},G=r("label",{for:"edit-correo"},"Correo",-1),H=r("br",null,null,-1),J={class:"p-d-flex p-jc-end"};function L(o,e,O,R,i,u){const n=l("InputText"),d=l("Button"),v=l("Panel"),c=l("Column"),h=l("DataTable"),m=l("Dialog"),f=l("Toast");return S(),E("div",null,[r("div",w,[r("div",T,[r("div",k,[s(v,{header:"Supervisores registrados",style:{height:"100%"}},{default:p(()=>[r("div",C,[r("div",y,[s(n,{type:"text",placeholder:"Teléfono del Supervisor",modelValue:i.telefono_supervisor,"onUpdate:modelValue":e[0]||(e[0]=t=>i.telefono_supervisor=t)},null,8,["modelValue"]),s(n,{type:"text",placeholder:"Correo del Supervisor",modelValue:i.correo_supervisor,"onUpdate:modelValue":e[1]||(e[1]=t=>i.correo_supervisor=t)},null,8,["modelValue"]),s(d,{label:"Buscar",icon:"pi pi-search",onClick:u.buscarSupervisorPorTelefonoYCorreo},null,8,["onClick"])])])]),_:1}),s(h,{value:i.supervisores,paginator:!0,rows:5,rowsPerPageOptions:[5,10,25],responsiveLayout:"scroll"},{default:p(()=>[s(c,{field:"nombre",header:"Nombre",sortable:!0,style:{width:"25%"}}),s(c,{field:"cargo",header:"Cargo",sortable:!0,style:{width:"25%"}}),s(c,{field:"telefono",header:"Teléfono",sortable:!0,style:{width:"25%"}}),s(c,{field:"correo",header:"Correo",sortable:!0,style:{width:"25%"}}),s(c,{style:{width:"150px"}},{header:p(()=>[g(" Editar/Eliminar ")]),body:p(t=>[s(d,{icon:"pi pi-pencil",class:"p-button-success p-mr-2",onClick:_=>u.editarSupervisor(t.data)},null,8,["onClick"]),s(d,{icon:"pi pi-trash",class:"p-button-danger",onClick:_=>u.confirmarEliminacionSupervisor(t.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])])])]),s(m,{header:"Editar Supervisor",visible:i.editarDialogVisible,onHide:e[6]||(e[6]=t=>i.editarDialogVisible=!1)},{default:p(()=>[r("div",null,[r("div",x,[r("div",D,[r("div",N,[r("div",B,[P,s(n,{id:"edit-nombre",modelValue:i.supervisorEdit.nombre,"onUpdate:modelValue":e[2]||(e[2]=t=>i.supervisorEdit.nombre=t)},null,8,["modelValue"])]),j,r("div",U,[A,s(n,{id:"edit-cargo",modelValue:i.supervisorEdit.cargo,"onUpdate:modelValue":e[3]||(e[3]=t=>i.supervisorEdit.cargo=t)},null,8,["modelValue"])]),I,r("div",W,[q,s(n,{id:"edit-telefono",modelValue:i.supervisorEdit.telefono,"onUpdate:modelValue":e[4]||(e[4]=t=>i.supervisorEdit.telefono=t),readonly:""},null,8,["modelValue"])]),Y,r("div",z,[G,s(n,{id:"edit-correo",modelValue:i.supervisorEdit.correo,"onUpdate:modelValue":e[5]||(e[5]=t=>i.supervisorEdit.correo=t),readonly:""},null,8,["modelValue"])]),H])])]),r("div",J,[s(d,{label:"Cancelar",class:"p-button-text",onClick:u.cancelarEdicionSupervisor},null,8,["onClick"]),s(d,{label:"Guardar",class:"p-button-success",onClick:u.guardarEdicionSupervisor},null,8,["onClick"])])])]),_:1},8,["visible"]),s(f,{ref:"toast"},null,512)])}const K=b(V,[["render",L]]);export{K as default};
