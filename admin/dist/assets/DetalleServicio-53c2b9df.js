import{a}from"./axios-47b9d439.js";import{_ as h,a as r,b as p,c as f,d as s,e as l,j as _}from"./index-e9023bbb.js";const v={data(){return{formData:{folio_solicitud:null,id_servicio:""},folio_solicitudOptions:[],authToken:null}},created(){this.obtenerToken(),this.cargarFolio()},methods:{obtenerToken(){const e={username:"admin",password:"secretaacces123"};a.post("https://api-constructora.onrender.com/token",{username:e.username,password:e.password},{headers:{"Content-Type":"application/json"}}).then(o=>{this.authToken=o.data.access_token,a.defaults.headers.common.Authorization=`Bearer ${this.authToken}`,this.cargarFolio(),this.cargarServicio()}).catch(o=>{console.error("Error al obtener el token JWT",o),o.response&&console.error("Respuesta del servidor:",o.response.data)})},cargarFolio(){this.authToken&&a.get(`https://api-constructora.onrender.com/solicitud_proyecto/ver-todas?jsonwebtoken=${this.authToken}`).then(e=>{this.folio_solicitudOptions=e.data.map(o=>o.folio_solicitud)}).catch(e=>{console.error("Error al obtener los datos de la API",e)})},submitForm(){if(console.log("Submit button clicked"),this.validateFields()){const e=`https://api-constructora.onrender.com/servicio_detalle_solicitud/create/?id_servicio=${this.formData.id_servicio}&folio_solicitud=${this.formData.folio_solicitud}&jsonwebtoken=${this.authToken}`;a.post(e).then(o=>{o.status===200&&(this.showSuccessToast("¡Servicio anexado exitosamente!"),this.limpiarCamposEntrada())}).catch(o=>{console.error("Error al anexar servicio a la solicitud",o),this.showApiErrorToast(o)})}},validateFields(){return this.formData.folio_solicitud!==null&&this.formData.id_servicio!==""?!0:(this.showValidationError("Por favor, complete todos los campos correctamente."),!1)},showSuccessToast(e){this.$refs.toast.add({severity:"success",summary:"Éxito",detail:e,life:3e3})},showApiErrorToast(e){e.response&&(e.response.status===422?e="Error de validacion":e="Ya se ha agregado dicho servicio"),this.$refs.toast.add({severity:"error",summary:"Error",detail:e,life:5e3})},showValidationError(e){this.$refs.toast.add({severity:"error",summary:"Error de validación",detail:e,life:5e3})},limpiarCamposEntrada(){this.formData.folio_solicitud=null,this.formData.id_servicio=""}}},b=s("h1",null,"Anexar servicio a una solicitud",-1),T={class:"col-6 md:6"},k={class:"card p-fluid"},w={class:"field col-9 md-6"},D=s("label",{for:"id_servicio"},"ID de Servicio",-1),E={class:"field col-9 md-6"},x=s("label",{for:"folio_solicitud"},"Folio de solicitud:",-1),g={class:"field col-4 md-3"};function y(e,o,F,V,t,d){const n=r("InputText"),c=r("Dropdown"),u=r("Button"),m=r("Toast");return p(),f("div",null,[b,s("form",{onSubmit:o[2]||(o[2]=_((...i)=>d.submitForm&&d.submitForm(...i),["prevent"])),class:"grid"},[s("div",T,[s("div",k,[s("div",w,[D,l(n,{id:"id_servicio",type:"text",modelValue:t.formData.id_servicio,"onUpdate:modelValue":o[0]||(o[0]=i=>t.formData.id_servicio=i),placeholder:"Identificador de servicio",required:""},null,8,["modelValue"])]),s("div",E,[x,l(c,{id:"folio_solicitud",modelValue:t.formData.folio_solicitud,"onUpdate:modelValue":o[1]||(o[1]=i=>t.formData.folio_solicitud=i),options:t.folio_solicitudOptions,showClear:"",placeholder:"Folio de la solicitud",required:""},null,8,["modelValue","options"])]),s("div",g,[l(u,{label:"Registrar",class:"p-button-success mr-2 mb-2",type:"submit"})])])])],32),l(m,{ref:"toast"},null,512)])}const B=h(v,[["render",y]]);export{B as default};
