import{a as d}from"./axios-47b9d439.js";import{_ as S,a as c,b as V,c as k,d as t,e,w as u,g as _}from"./index-e9023bbb.js";const C={data(){return{solicitudes:[],eliminarDialogVisible:!1,editarDialogVisible:!1,folioSolicitud:"",confirmacionSolicitud:null,solicitudEdit:{folio_solicitud:"",fecha:null,monto_presupuesto:null,monto_anticipo:null},authToken:null}},created(){this.obtenerToken()},methods:{obtenerToken(){const i={username:"admin",password:"secretaacces123"};d.post("https://api-constructora.onrender.com/token",{username:i.username,password:i.password},{headers:{"Content-Type":"application/json"}}).then(o=>{console.log(o),this.authToken=o.data.access_token,d.defaults.headers.common.Authorization=`Bearer ${this.authToken}`,this.cargarSolicitudes()}).catch(o=>{console.error("Error al obtener el token JWT",o),o.response&&console.error("Respuesta del servidor:",o.response.data)})},cargarSolicitudes(){d.get(`https://api-constructora.onrender.com/solicitud_proyecto/ver-todas?jsonwebtoken=${this.authToken}`).then(i=>{this.solicitudes=i.data.filter(o=>o.estado==="aceptado"||o.estado==="Rechazado")}).catch(i=>{console.error("Error al obtener los datos de la API",i)})},confirmarEliminacion(i){this.eliminarDialogVisible=!0,this.confirmacionSolicitud=i},eliminarSolicitud(){if(this.confirmacionSolicitud){const i=`https://api-constructora.onrender.com/solicitud_proyecto/delete/${this.confirmacionSolicitud.folio_solicitud}?jsonwebtoken=${this.authToken}`;d.delete(i).then(o=>{o.status===200&&(this.cargarSolicitudes(),this.mostrarNotificacion("Eliminación exitosa","La solicitud ha sido eliminada con éxito.","success"))}).catch(o=>{console.error("Error al eliminar la solicitud",o),this.mostrarNotificacion("Error","No se pudo eliminar la solicitud.","error")})}this.eliminarDialogVisible=!1},mostrarNotificacion(i,o,h){this.$refs.toast.add({severity:h,summary:i,detail:o,life:5e3})},buscarSolicitudPorFolio(){if(this.folioSolicitud){const i=`https://api-constructora.onrender.com/solicitud_proyecto/ver1/${this.folioSolicitud}?jsonwebtoken=${this.authToken}`;d.get(i).then(o=>{this.solicitudes=[o.data],this.mostrarNotificacion("Solicitud encontrada!","Solicitud encontrada con éxito.","success")}).catch(o=>{console.error("Error al buscar solicitud por folio",o),this.mostrarNotificacion("Error","No se pudo encontrar la solicitud.","error")})}else this.mostrarNotificacion("Advertencia","Ingrese un folio de solicitud para buscar.","warn")},validateAmount(i){return!(i<0||String(i).toLowerCase().includes("e"))},getCurrentDate(){const i=new Date,o=i.getFullYear(),h=String(i.getMonth()+1).padStart(2,"0"),m=String(i.getDate()).padStart(2,"0");return`${o}-${h}-${m}`},editarSolicitud(i){this.solicitudEdit={...i},this.editarDialogVisible=!0},cancelarEdicion(){this.editarDialogVisible=!1,this.solicitudEdit={folio_solicitud:"",fecha:null,monto_presupuesto:null,monto_anticipo:null}},guardarEdicion(){if(this.solicitudEdit){if(!this.validateAmount(this.solicitudEdit.monto_presupuesto)||!this.validateAmount(this.solicitudEdit.monto_anticipo)){this.showValidationError("Los montos no pueden ser negativos.");return}d.put(`https://api-constructora.onrender.com/solicitud_proyecto/update/${this.solicitudEdit.folio_solicitud}`,this.solicitudEdit).then(i=>{i.status===200&&(this.cargarSolicitudes(),this.editarDialogVisible=!1,this.mostrarNotificacion("Actualización exitosa","La solicitud ha sido actualizada con éxito.","success"))}).catch(i=>{console.error("Error al actualizar la solicitud",i),this.mostrarNotificacion("Error","No se pudo actualizar la solicitud.","error")})}}}},D={class:"p-grid"},x={class:"p-col-12"},T={class:"card"},w={class:"p-grid"},y={class:"p-col-12 p-md-8"},N=t("div",null,[_(" ¿Estás seguro de que deseas eliminar esta solicitud? "),t("br")],-1),A=t("br",null,null,-1),P={class:"p-d-flex p-jc-end"},F={class:"p-grid"},B={class:"p-col-12"},j={class:"p-fluid"},z={class:"p-field"},I=t("label",{for:"edit-folio"},"Folio de solicitud",-1),L=t("br",null,null,-1),M={class:"p-field"},U=t("label",{for:"fecha"},"Fecha:",-1),R=t("br",null,null,-1),q={class:"p-field"},H=t("label",{for:"edit-monto-presupuesto"},"Monto de Presupuesto",-1),G=t("br",null,null,-1),J={class:"p-field"},O=t("label",{for:"edit-monto-anticipo"},"Monto de Anticipo",-1),W=t("br",null,null,-1),Y={class:"p-d-flex p-jc-end"};function K(i,o,h,m,l,n){const p=c("InputText"),r=c("Button"),b=c("Panel"),a=c("Column"),g=c("DataTable"),f=c("Dialog"),E=c("Toast");return V(),k("div",null,[t("div",D,[t("div",x,[t("div",T,[e(b,{header:"Solicitudes de Proyecto Registradas",style:{height:"100%"}},{default:u(()=>[t("div",w,[t("div",y,[e(p,{type:"text",placeholder:"Folio de Solicitud",modelValue:l.folioSolicitud,"onUpdate:modelValue":o[0]||(o[0]=s=>l.folioSolicitud=s)},null,8,["modelValue"]),e(r,{label:"Buscar",icon:"pi pi-search",onClick:n.buscarSolicitudPorFolio},null,8,["onClick"])])])]),_:1}),e(g,{value:l.solicitudes,paginator:!0,rows:5,rowsPerPageOptions:[5,10,25],responsiveLayout:"scroll"},{default:u(()=>[e(a,{field:"id_solicitud",header:"ID Solicitud",sortable:!0}),e(a,{field:"nombre_empresa",header:"Nombre de empresa",sortable:!0}),e(a,{field:"fecha",header:"Fecha",sortable:!0}),e(a,{field:"monto_presupuesto",header:"Monto de Presupuesto",sortable:!0}),e(a,{field:"monto_anticipo",header:"Monto de Anticipo",sortable:!0}),e(a,{field:"folio_solicitud",header:"Folio de Solicitud",sortable:!0}),e(a,{field:"estado",header:"Estado",sortable:!0}),e(a,{style:{width:"150px"}},{header:u(()=>[_(" Editar/Eliminar Registro ")]),body:u(s=>[e(r,{icon:"pi pi-pencil",class:"p-button-success p-mr-2",onClick:v=>n.editarSolicitud(s.data)},null,8,["onClick"]),e(r,{icon:"pi pi-trash",class:"p-button-danger",onClick:v=>n.confirmarEliminacion(s.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])])])]),e(f,{header:"Confirmar Eliminación",visible:l.eliminarDialogVisible,onHide:o[2]||(o[2]=s=>l.eliminarDialogVisible=!1)},{default:u(()=>[N,A,t("div",P,[e(r,{label:"Cancelar",class:"p-button-text",onClick:o[1]||(o[1]=s=>l.eliminarDialogVisible=!1)}),e(r,{label:"Eliminar",class:"p-button-danger",onClick:n.eliminarSolicitud},null,8,["onClick"])])]),_:1},8,["visible"]),e(f,{header:"Editar Solicitud",visible:l.editarDialogVisible,onHide:o[7]||(o[7]=s=>l.editarDialogVisible=!1)},{default:u(()=>[t("div",null,[t("div",F,[t("div",B,[t("div",j,[t("div",z,[I,e(p,{id:"edit-folio",modelValue:l.solicitudEdit.folio_solicitud,"onUpdate:modelValue":o[3]||(o[3]=s=>l.solicitudEdit.folio_solicitud=s),readonly:""},null,8,["modelValue"])]),L,t("div",M,[U,e(p,{id:"edit-fecha",type:"date",modelValue:l.solicitudEdit.fecha,"onUpdate:modelValue":o[4]||(o[4]=s=>l.solicitudEdit.fecha=s),max:n.getCurrentDate(),required:""},null,8,["modelValue","max"])]),R,t("div",q,[H,e(p,{id:"edit-monto-presupuesto",modelValue:l.solicitudEdit.monto_presupuesto,"onUpdate:modelValue":o[5]||(o[5]=s=>l.solicitudEdit.monto_presupuesto=s)},null,8,["modelValue"])]),G,t("div",J,[O,e(p,{id:"edit-monto-anticipo",modelValue:l.solicitudEdit.monto_anticipo,"onUpdate:modelValue":o[6]||(o[6]=s=>l.solicitudEdit.monto_anticipo=s)},null,8,["modelValue"])]),W])])]),t("div",Y,[e(r,{label:"Cancelar",class:"p-button-text",onClick:n.cancelarEdicion},null,8,["onClick"]),e(r,{label:"Guardar",class:"p-button-success",onClick:n.guardarEdicion},null,8,["onClick"])])])]),_:1},8,["visible"]),e(E,{ref:"toast"},null,512)])}const Z=S(C,[["render",K]]);export{Z as default};
