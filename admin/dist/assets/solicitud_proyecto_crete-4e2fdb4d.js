import{a as l}from"./axios-47b9d439.js";import{_ as h,a as n,b as _,c as D,d as t,e as r,j as b}from"./index-e9023bbb.js";const v="/assets/herramientas-f110e5d3.jpg",E={data(){return{formData:{id_empresa:null,fecha:"",monto_presupuesto:null,monto_anticipo:null,folio_solicitud:"",estado:null},estadoOptions:[{label:"Aceptado",value:"aceptado"},{label:"Rechazado",value:"rechazado"},{label:"En espera",value:"en espera"}],nombreEmpresaOptions:[]}},created(){this.obtenerToken()},methods:{obtenerToken(){const e={username:"admin",password:"secretaacces123"};l.post("https://api-constructora.onrender.com/token",{username:e.username,password:e.password},{headers:{"Content-Type":"application/json"}}).then(o=>{console.log(o),this.authToken=o.data.access_token,l.defaults.headers.common.Authorization=`Bearer ${this.authToken}`,this.cargarEmpresas()}).catch(o=>{console.error("Error al obtener el token JWT",o),o.response&&console.error("Respuesta del servidor:",o.response.data)})},cargarEmpresas(){this.authToken&&l.get(`https://api-constructora.onrender.com/empresa/ver-todas?jsonwebtoken=${this.authToken}`).then(e=>{this.nombreEmpresaOptions=e.data.map(o=>o.nombre)}).catch(e=>{console.error("Error al obtener los datos de la API",e)})},validateAmount(e){return!(e<0||String(e).toLowerCase().includes("e"))},submitForm(){if(console.log("Submit button clicked"),this.validateFields()){if(!this.validateAmount(this.formData.monto_presupuesto)||!this.validateAmount(this.formData.monto_anticipo)){this.showValidationError("Los montos no pueden ser negativos.");return}const e=`https://api-constructora.onrender.com/solicitud_proyecto/create/?jsonwebtoken=${this.authToken}&nombre_empresa=${this.formData.id_empresa}&fecha=${this.formData.fecha}&monto_presupuesto=${this.formData.monto_presupuesto}&monto_anticipo=${this.formData.monto_anticipo}&folio_solicitud=${this.formData.folio_solicitud}&estado=${this.formData.estado}`;l.post(e).then(o=>{o.status===200&&(this.showSuccessToast("¡Solicitud creada exitosamente!"),this.limpiarCamposEntrada())}).catch(o=>{console.error("Error al crear la Solicitud",o),this.showApiErrorToast(o)})}},validateFields(){return this.formData.id_empresa!==null&&this.formData.fecha&&this.formData.monto_presupuesto!==null&&this.formData.monto_anticipo!==null&&this.formData.folio_solicitud&&this.formData.estado!==null&&this.formData.estado!==""?!0:(this.showValidationError("Por favor, complete todos los campos, incluyendo el campo Estado y nombre de empresa."),!1)},getCurrentDate(){const e=new Date,o=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),u=String(e.getDate()).padStart(2,"0");return`${o}-${d}-${u}`},showSuccessToast(e){this.$refs.toast.add({severity:"success",summary:"Éxito",detail:e,life:3e3})},showValidationError(e){this.$refs.toast.add({severity:"error",summary:"Error de validación",detail:e,life:5e3})},showApiErrorToast(e){let o="Error al procesar la solicitud";e.response&&(e.response.status===422?o="Error de validacion":o="Ya existe la solicitud"),this.$refs.toast.add({severity:"error",summary:"Error",detail:o,life:5e3})},limpiarCamposEntrada(){this.formData.id_empresa=null,this.formData.fecha="",this.formData.monto_presupuesto=null,this.formData.monto_anticipo=null,this.formData.folio_solicitud="",this.formData.estado=null,this.formData.estado=""}}},V=t("h1",null,"Registro de Solicitud de Proyecto",-1),g={class:"col-6 md:6"},y={class:"card p-fluid"},w={class:"field col-9 md-6"},T=t("label",{for:"nombre_empresa"},"Nombre de la empresa:",-1),k={class:"field col-9 md-6"},S=t("label",{for:"fecha"},"Fecha:",-1),x={class:"field col-9 md-6"},C=t("label",{for:"monto_presupuesto"},"Monto de Presupuesto:",-1),A={class:"field col-9 md-6"},j=t("label",{for:"monto_anticipo"},"Monto de Anticipo:",-1),F={class:"field col-9 md-6"},q=t("label",{for:"folio_solicitud"},"Folio de Solicitud:",-1),B={class:"field col-9 md-6"},O=t("label",{for:"estado"},"Estado:",-1),U={class:"field col-4 md-3"},L=t("div",{class:"col-6 md:6"},[t("div",{class:"card p-fluid"},[t("img",{src:v,alt:"Logo representativo 2",style:{"max-width":"100%",height:"auto"}})])],-1);function M(e,o,d,u,s,m){const c=n("Dropdown"),i=n("InputText"),p=n("Button"),f=n("Toast");return _(),D("div",null,[V,t("form",{onSubmit:o[6]||(o[6]=b((...a)=>m.submitForm&&m.submitForm(...a),["prevent"])),class:"grid"},[t("div",g,[t("div",y,[t("div",w,[T,r(c,{id:"nombre_empresa",modelValue:s.formData.id_empresa,"onUpdate:modelValue":o[0]||(o[0]=a=>s.formData.id_empresa=a),options:s.nombreEmpresaOptions,showClear:"",required:""},null,8,["modelValue","options"])]),t("div",k,[S,r(i,{id:"fecha",type:"date",modelValue:s.formData.fecha,"onUpdate:modelValue":o[1]||(o[1]=a=>s.formData.fecha=a),max:m.getCurrentDate(),required:""},null,8,["modelValue","max"])]),t("div",x,[C,r(i,{id:"monto_presupuesto",type:"number",modelValue:s.formData.monto_presupuesto,"onUpdate:modelValue":o[2]||(o[2]=a=>s.formData.monto_presupuesto=a),placeholder:"Ejemplo: $50000.00",required:""},null,8,["modelValue"])]),t("div",A,[j,r(i,{id:"monto_anticipo",type:"number",modelValue:s.formData.monto_anticipo,"onUpdate:modelValue":o[3]||(o[3]=a=>s.formData.monto_anticipo=a),placeholder:"Ejemplo: $10000.00",required:""},null,8,["modelValue"])]),t("div",F,[q,r(i,{id:"folio_solicitud",type:"text",modelValue:s.formData.folio_solicitud,"onUpdate:modelValue":o[4]||(o[4]=a=>s.formData.folio_solicitud=a),placeholder:"Ejemplo: SOL-2023-001",required:""},null,8,["modelValue"])]),t("div",B,[O,r(c,{id:"estado",modelValue:s.formData.estado,"onUpdate:modelValue":o[5]||(o[5]=a=>s.formData.estado=a),options:s.estadoOptions,optionLabel:"label",optionValue:"value",placeholder:"Estado del proyecto",required:""},null,8,["modelValue","options"])]),t("div",U,[r(p,{label:"Registrar",class:"p-button-success mr-2 mb-2",type:"submit"})])])]),L],32),r(f,{ref:"toast"},null,512)])}const $=h(E,[["render",M]]);export{$ as default};
