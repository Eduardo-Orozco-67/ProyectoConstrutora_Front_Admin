import{a as d}from"./axios-47b9d439.js";import{_ as E,a as n,b as v,c as g,d as i,e,w as u,g as P}from"./index-e9023bbb.js";const k={data(){return{proyectos:[],eliminarDialogVisible:!1,editarDialogVisible:!1,folio_solicitud:"",folioProyecto:"",confirmacionProyecto:null,proyectoEdit:{id_proyecto:null,nombre_empresa:"",folio_solicitud:"",fecha_inicio:null,fecha_fin:null,monto:null,prioridad:"",porcentaje_avance:null,estado_proyecto:""},authToken:null}},created(){this.obtenerToken()},methods:{obtenerToken(){const t={username:"admin",password:"secretaacces123"};d.post("https://api-constructora.onrender.com/token",{username:t.username,password:t.password},{headers:{"Content-Type":"application/json"}}).then(o=>{this.authToken=o.data.access_token,d.defaults.headers.common.Authorization=`Bearer ${this.authToken}`,this.cargarProyectos()}).catch(o=>{console.error("Error al obtener el token JWT",o),o.response&&console.error("Respuesta del servidor:",o.response.data)})},cargarProyectos(){this.authToken&&d.get(`https://api-constructora.onrender.com/proyecto/ver-todos?jsonwebtoken=${this.authToken}`).then(t=>{this.proyectos=t.data}).catch(t=>{console.error("Error al obtener los datos de la API",t)})},confirmarEliminacion(t){this.eliminarDialogVisible=!0,this.confirmacionProyecto=t},eliminarProyecto(){if(this.confirmacionProyecto){const t=`https://api-constructora.onrender.com/proyecto/delete/${this.confirmacionProyecto.folio_solicitud}?jsonwebtoken=${this.authToken}`;d.delete(t).then(o=>{o.status===200&&(this.cargarProyectos(),this.mostrarNotificacion("Eliminación exitosa","El proyecto ha sido eliminado con éxito.","success"))}).catch(o=>{console.error("Error al eliminar el proyecto",o),this.mostrarNotificacion("Error","No se pudo eliminar el proyecto.","error")})}this.eliminarDialogVisible=!1},mostrarNotificacion(t,o,h){this.$refs.toast.add({severity:h,summary:t,detail:o,life:5e3})},buscarProyectoPorFolio(){this.folio_solicitud&&this.authToken?d.get(`https://api-constructora.onrender.com/proyecto/ver1/${this.folio_solicitud}?jsonwebtoken=${this.authToken}`).then(t=>{this.proyectos=[t.data],this.mostrarNotificacion("Proyecto encontrado!","Proyecto encontrada con éxito.","success")}).catch(t=>{console.error("Error al buscar Proyecto por folio",t),this.mostrarNotificacion("Error","No se pudo encontrar el Proyecto.","error")}):this.mostrarNotificacion("Advertencia","Ingrese un folio de proyecto para buscar.","warn")},editarProyecto(t){this.proyectoEdit={...t},this.editarDialogVisible=!0},cancelarEdicion(){this.editarDialogVisible=!1,this.proyectoEdit={id_proyecto:null,nombre_empresa:"",folio_solicitud:"",fecha_inicio:null,fecha_fin:null,monto:null,prioridad:"",porcentaje_avance:null,estado_proyecto:""}},guardarEdicion(){this.proyectoEdit&&d.put(`https://api-constructora.onrender.com/proyecto/update/${this.proyectoEdit.id_proyecto}`,this.proyectoEdit).then(t=>{t.status===200&&(this.cargarProyectos(),this.editarDialogVisible=!1,this.mostrarNotificacion("Actualización exitosa","El proyecto ha sido actualizado con éxito.","success"))}).catch(t=>{console.error("Error al actualizar el proyecto",t),this.mostrarNotificacion("Error","No se pudo actualizar el proyecto.","error")})}}},V={class:"p-grid"},w={class:"p-col-12"},C={class:"card"},x={class:"p-grid"},T={class:"p-col-12 p-md-8"},D=i("div",null," ¿Estás seguro de que deseas eliminar esta solicitud? ",-1),N={class:"p-d-flex p-jc-end"},j={class:"p-grid"},F={class:"p-col-12"},I={class:"p-fluid"},B={class:"p-field"},A=i("label",{for:"edit-id-proyecto"},"ID de Proyecto",-1),z=i("br",null,null,-1),U={class:"p-field"},H=i("label",{for:"edit-nombre-empresa"},"Nombre Empresa",-1),S=i("br",null,null,-1),q={class:"p-field"},G=i("label",{for:"edit-folio-solicitud"},"Folio de Solicitud",-1),J=i("br",null,null,-1),L={class:"p-field"},M=i("label",{for:"edit-fecha-inicio"},"Fecha Inicio",-1),O=i("br",null,null,-1),R={class:"p-d-flex p-jc-end"};function W(t,o,h,K,r,c){const p=n("InputText"),a=n("Button"),f=n("Panel"),s=n("Column"),_=n("DataTable"),m=n("Dialog"),y=n("Toast");return v(),g("div",null,[i("div",V,[i("div",w,[i("div",C,[e(f,{header:"Proyectos registrados",style:{height:"100%"}},{default:u(()=>[i("div",x,[i("div",T,[e(p,{type:"text",placeholder:"Folio de solicitud",modelValue:r.folio_solicitud,"onUpdate:modelValue":o[0]||(o[0]=l=>r.folio_solicitud=l)},null,8,["modelValue"]),e(a,{label:"Buscar",icon:"pi pi-search",onClick:c.buscarProyectoPorFolio},null,8,["onClick"])])])]),_:1}),e(_,{value:r.proyectos,paginator:!0,rows:5,rowsPerPageOptions:[5,10,25],responsiveLayout:"scroll"},{default:u(()=>[e(s,{field:"id_proyecto",header:"ID Proyecto",sortable:!0,style:{width:"10%"}}),e(s,{field:"empresa",header:"Empresa",sortable:!0,style:{width:"10%"}}),e(s,{field:"folio_solicitud",header:"Folio de Solicitud",sortable:!0,style:{width:"10%"}}),e(s,{field:"fecha_inicio",header:"Fecha Inicio",sortable:!0,style:{width:"15%"}}),e(s,{field:"fecha_fin",header:"Fecha Fin",sortable:!0,style:{width:"15%"}}),e(s,{field:"monto",header:"Monto",sortable:!0,style:{width:"15%"}}),e(s,{field:"prioridad",header:"Prioridad",sortable:!0,style:{width:"10%"}}),e(s,{field:"porcentaje_avance",header:"Porcentaje Avance",sortable:!0,style:{width:"10%"}}),e(s,{field:"estado_proyecto",header:"Estado Proyecto",sortable:!0,style:{width:"15%"}}),e(s,{style:{width:"150px"}},{header:u(()=>[P(" Editar/Eliminar ")]),body:u(l=>[e(a,{icon:"pi pi-pencil",class:"p-button-success p-mr-2",onClick:b=>c.editarProyecto(l.data)},null,8,["onClick"]),e(a,{icon:"pi pi-trash",class:"p-button-danger",onClick:b=>c.confirmarEliminacion(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])])])]),e(m,{header:"Confirmar Eliminación",visible:r.eliminarDialogVisible,onHide:o[2]||(o[2]=l=>r.eliminarDialogVisible=!1)},{default:u(()=>[D,i("div",N,[e(a,{label:"Cancelar",class:"p-button-text",onClick:o[1]||(o[1]=l=>r.eliminarDialogVisible=!1)}),e(a,{label:"Eliminar",class:"p-button-danger",onClick:c.eliminarProyecto},null,8,["onClick"])])]),_:1},8,["visible"]),e(m,{header:"Editar Proyecto",visible:r.editarDialogVisible,onHide:o[7]||(o[7]=l=>r.editarDialogVisible=!1)},{default:u(()=>[i("div",null,[i("div",j,[i("div",F,[i("div",I,[i("div",B,[A,e(p,{id:"edit-id-proyecto",modelValue:r.proyectoEdit.id_proyecto,"onUpdate:modelValue":o[3]||(o[3]=l=>r.proyectoEdit.id_proyecto=l)},null,8,["modelValue"])]),z,i("div",U,[H,e(p,{id:"edit-nombre-empresa",modelValue:r.proyectoEdit.nombre_empresa,"onUpdate:modelValue":o[4]||(o[4]=l=>r.proyectoEdit.nombre_empresa=l)},null,8,["modelValue"])]),S,i("div",q,[G,e(p,{id:"edit-folio-solicitud",modelValue:r.proyectoEdit.folio_solicitud,"onUpdate:modelValue":o[5]||(o[5]=l=>r.proyectoEdit.folio_solicitud=l)},null,8,["modelValue"])]),J,i("div",L,[M,e(p,{id:"edit-fecha-inicio",modelValue:r.proyectoEdit.fecha_inicio,"onUpdate:modelValue":o[6]||(o[6]=l=>r.proyectoEdit.fecha_inicio=l)},null,8,["modelValue"])]),O])])]),i("div",R,[e(a,{label:"Cancelar",class:"p-button-text",onClick:c.cancelarEdicion},null,8,["onClick"]),e(a,{label:"Guardar",class:"p-button-success",onClick:c.guardarEdicion},null,8,["onClick"])])])]),_:1},8,["visible"]),e(y,{ref:"toast"},null,512)])}const Y=E(k,[["render",W]]);export{Y as default};
