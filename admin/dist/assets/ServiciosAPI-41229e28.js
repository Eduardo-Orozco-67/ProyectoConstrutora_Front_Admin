import{a as l}from"./axios-47b9d439.js";import{_ as k,a as n,b as S,c as V,d as e,e as s,w as d,g as b}from"./index-e9023bbb.js";const C={data(){return{servicios:[],eliminarDialogVisible:!1,editarDialogVisible:!1,nombreServicio:"",confirmacionServicio:null,servicioEdit:{servicio:"",descripcion:""},authToken:null}},created(){this.obtenerToken()},methods:{obtenerToken(){const o={username:"admin",password:"secretaacces123"};l.post("https://api-constructora.onrender.com/token",{username:o.username,password:o.password},{headers:{"Content-Type":"application/json"}}).then(i=>{console.log(i),this.authToken=i.data.access_token,l.defaults.headers.common.Authorization=`Bearer ${this.authToken}`,this.cargarServicios()}).catch(i=>{console.error("Error al obtener el token JWT",i),i.response&&console.error("Respuesta del servidor:",i.response.data)})},cargarServicios(){l.get(`https://api-constructora.onrender.com/servicio/ver-todos?jsonwebtoken=${this.authToken}`).then(o=>{this.servicios=o.data}).catch(o=>{console.error("Error al obtener los datos de la API",o)})},confirmarEliminacion(o){this.eliminarDialogVisible=!0,this.confirmacionServicio=o},eliminarServicio(){if(this.confirmacionServicio){const o=`https://api-constructora.onrender.com/servicio/delete/${this.confirmacionServicio.servicio}?jsonwebtoken=${this.authToken}`;l.delete(o).then(i=>{i.status===200&&(this.cargarServicios(),this.mostrarNotificacion("Eliminación exitosa","El servicio ha sido eliminado con éxito.","success"))}).catch(i=>{console.error("Error al eliminar el servicio",i),this.mostrarNotificacion("Error","No se pudo eliminar el servicio.","error")})}this.eliminarDialogVisible=!1},mostrarNotificacion(o,i,u){this.$refs.toast.add({severity:u,summary:o,detail:i,life:5e3})},buscarServicioPorNombre(){if(this.nombreServicio){const o=`https://api-constructora.onrender.com/servicio/ver1/${this.nombreServicio}?jsonwebtoken=${this.authToken}`;l.get(o).then(i=>{this.servicios=[i.data],this.mostrarNotificacion("Servicio encontrado!","Servicio encontrado con éxito.","success")}).catch(i=>{console.error("Error al buscar servicio por nombre",i),this.mostrarNotificacion("Error","No se pudo encontrar el servicio.","error")})}else this.mostrarNotificacion("Advertencia","Ingrese un nombre de servicio para buscar.","warn")},editarServicio(o){this.servicioEdit={...o},this.editarDialogVisible=!0},cancelarEdicion(){this.editarDialogVisible=!1,this.servicioEdit={servicio:"",descripcion:""}},guardarEdicion(){if(this.servicioEdit){const{servicio:o,descripcion:i}=this.servicioEdit,u=`https://api-constructora.onrender.com/servicio/update/${o}?nueva_descripcion=${i}&jsonwebtoken=${this.authToken}`;l.patch(u).then(v=>{v.status===200&&(this.cargarServicios(),this.editarDialogVisible=!1,this.mostrarNotificacion("Actualización exitosa","El servicio ha sido actualizado con éxito.","success"))}).catch(v=>{console.error("Error al actualizar el servicio",v),this.mostrarNotificacion("Error","No se pudo actualizar el servicio.","error")})}}}},x={class:"p-grid"},D={class:"p-col-12"},T={class:"card"},N={class:"p-grid"},w={class:"p-col-12 p-md-8"},j=e("div",null,[b(" ¿Estás seguro de que deseas eliminar este servicio? "),e("br")],-1),y=e("br",null,null,-1),B={class:"p-d-flex p-jc-end"},P={class:"p-grid"},z={class:"p-col-12"},A={class:"p-fluid"},I={class:"p-field"},R=e("label",{for:"edit-servicio"},"Servicio",-1),U=e("br",null,null,-1),H={class:"p-field"},q=e("label",{for:"edit-descripcion"},"Descripción",-1),G=e("br",null,null,-1),J={class:"p-d-flex p-jc-end"};function L(o,i,u,v,r,a){const p=n("InputText"),c=n("Button"),_=n("Panel"),h=n("Column"),f=n("DataTable"),m=n("Dialog"),g=n("Toast");return S(),V("div",null,[e("div",x,[e("div",D,[e("div",T,[s(_,{header:"Servicios Registrados",style:{height:"100%"}},{default:d(()=>[e("div",N,[e("div",w,[s(p,{type:"text",placeholder:"Nombre del Servicio",modelValue:r.nombreServicio,"onUpdate:modelValue":i[0]||(i[0]=t=>r.nombreServicio=t)},null,8,["modelValue"]),s(c,{label:"Buscar",icon:"pi pi-search",onClick:a.buscarServicioPorNombre},null,8,["onClick"])])])]),_:1}),s(f,{value:r.servicios,paginator:!0,rows:5,rowsPerPageOptions:[5,10,25],responsiveLayout:"scroll"},{default:d(()=>[s(h,{field:"servicio",header:"Servicio",sortable:!0}),s(h,{field:"descripcion",header:"Descripción",sortable:!0}),s(h,{style:{width:"150px"}},{header:d(()=>[b(" Editar/Eliminar Registro ")]),body:d(t=>[s(c,{icon:"pi pi-pencil",class:"p-button-success p-mr-2",onClick:E=>a.editarServicio(t.data)},null,8,["onClick"]),s(c,{icon:"pi pi-trash",class:"p-button-danger",onClick:E=>a.confirmarEliminacion(t.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])])])]),s(m,{header:"Confirmar Eliminación",visible:r.eliminarDialogVisible,onHide:i[2]||(i[2]=t=>r.eliminarDialogVisible=!1)},{default:d(()=>[j,y,e("div",B,[s(c,{label:"Cancelar",class:"p-button-text",onClick:i[1]||(i[1]=t=>r.eliminarDialogVisible=!1)}),s(c,{label:"Eliminar",class:"p-button-danger",onClick:a.eliminarServicio},null,8,["onClick"])])]),_:1},8,["visible"]),s(m,{header:"Editar Servicio",visible:r.editarDialogVisible,onHide:i[5]||(i[5]=t=>r.editarDialogVisible=!1)},{default:d(()=>[e("div",null,[e("div",P,[e("div",z,[e("div",A,[e("div",I,[R,s(p,{id:"edit-servicio",modelValue:r.servicioEdit.servicio,"onUpdate:modelValue":i[3]||(i[3]=t=>r.servicioEdit.servicio=t),readonly:""},null,8,["modelValue"])]),U,e("div",H,[q,s(p,{id:"edit-descripcion",modelValue:r.servicioEdit.descripcion,"onUpdate:modelValue":i[4]||(i[4]=t=>r.servicioEdit.descripcion=t)},null,8,["modelValue"])]),G])])]),e("div",J,[s(c,{label:"Cancelar",class:"p-button-text",onClick:a.cancelarEdicion},null,8,["onClick"]),s(c,{label:"Guardar",class:"p-button-success",onClick:a.guardarEdicion},null,8,["onClick"])])])]),_:1},8,["visible"]),s(g,{ref:"toast"},null,512)])}const $=k(C,[["render",L]]);export{$ as default};
