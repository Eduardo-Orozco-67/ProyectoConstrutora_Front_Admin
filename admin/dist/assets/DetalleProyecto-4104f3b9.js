import{a as i}from"./axios-47b9d439.js";import{_ as p,a as l,b as f,c as m,d as s,e as a,j as h}from"./index-e9023bbb.js";const _={data(){return{formData:{folio_solicitud:null,telefono_supervisor:null},folio_solicitudOptions:[],telefono_supervisorOptions:[]}},created(){this.obtenerToken()},methods:{obtenerToken(){const e={username:"admin",password:"secretaacces123"};i.post("https://api-constructora.onrender.com/token",{username:e.username,password:e.password},{headers:{"Content-Type":"application/json"}}).then(o=>{console.log(o),this.authToken=o.data.access_token,i.defaults.headers.common.Authorization=`Bearer ${this.authToken}`,this.cargarFolio(),this.cargarTelefonoSupervisor()}).catch(o=>{console.error("Error al obtener el token JWT",o),o.response&&console.error("Respuesta del servidor:",o.response.data)})},cargarFolio(){this.authToken&&i.get(`https://api-constructora.onrender.com/proyecto/ver-todos?jsonwebtoken=${this.authToken}`).then(e=>{this.folio_solicitudOptions=e.data.map(o=>o.folio_solicitud)}).catch(e=>{console.error("Error al obtener los datos de la API",e)})},cargarTelefonoSupervisor(){this.authToken&&i.get(`https://api-constructora.onrender.com/supervisor/ver-todos/?jsonwebtoken=${this.authToken}`).then(e=>{this.telefono_supervisorOptions=e.data.map(o=>o.telefono)}).catch(e=>{console.error("Error al obtener los datos de la API",e)})},submitForm(){if(console.log("Submit button clicked"),this.validateFields()){const e=`https://api-constructora.onrender.com/proyecto_supervisor/create/?folio_solicitud=${this.formData.folio_solicitud}&telefono_supervisor=${this.formData.telefono_supervisor}&jsonwebtoken=${this.authToken}`;i.post(e).then(o=>{o.status===200&&(this.showSuccessToast("¡Supervisor agregado a proyecto exitosamente!"),this.limpiarCamposEntrada())}).catch(o=>{console.error("Error al agregar supervisor al proyecto",o),this.showApiErrorToast(o)})}},validateFields(){return this.formData.folio_solicitud!==null&&this.formData.telefono_supervisor!==null?!0:(this.showValidationError("Por favor, complete todos los campos."),!1)},showSuccessToast(e){this.$refs.toast.add({severity:"success",summary:"Éxito",detail:e,life:3e3})},showValidationError(e){this.$refs.toast.add({severity:"error",summary:"Error de validación",detail:e,life:5e3})},showApiErrorToast(e){e.response&&(e.response.status===422?errorMessage="Error de validacion":errorMessage="Ya existe la solicitud"),this.$refs.toast.add({severity:"error",summary:"Error",detail:errorMessage,life:5e3})},limpiarCamposEntrada(){this.formData.telefono_supervisor=null,this.formData.folio_solicitud=null}}},v=s("h1",null,"Registrar supervisor a proyectos",-1),b={class:"col-6 md:6"},T={class:"card p-fluid"},g={class:"field col-9 md-6"},k=s("label",{for:"folio_solicitud"},"Folio de solicitud:",-1),w={class:"field col-9 md-6"},y=s("label",{for:"telefono_supervisor"},"Telefono Supervisor:",-1),D={class:"field col-4 md-3"};function E(e,o,V,F,t,n){const d=l("Dropdown"),c=l("Button"),u=l("Toast");return f(),m("div",null,[v,s("form",{onSubmit:o[2]||(o[2]=h((...r)=>n.submitForm&&n.submitForm(...r),["prevent"])),class:"grid"},[s("div",b,[s("div",T,[s("div",g,[k,a(d,{id:"folio_solicitud",modelValue:t.formData.folio_solicitud,"onUpdate:modelValue":o[0]||(o[0]=r=>t.formData.folio_solicitud=r),options:t.folio_solicitudOptions,showClear:"",placeholder:"Folio de la solicitud de proyecto",required:""},null,8,["modelValue","options"])]),s("div",w,[y,a(d,{id:"telefono_supervisor",modelValue:t.formData.telefono_supervisor,"onUpdate:modelValue":o[1]||(o[1]=r=>t.formData.telefono_supervisor=r),options:t.telefono_supervisorOptions,showClear:"",placeholder:"Telefono del supervisor",required:""},null,8,["modelValue","options"])]),s("div",D,[a(c,{label:"Registrar",class:"p-button-success mr-2 mb-2",type:"submit"})])])])],32),a(u,{ref:"toast"},null,512)])}const x=p(_,[["render",E]]);export{x as default};
