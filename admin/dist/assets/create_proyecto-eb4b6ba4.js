import{a as c}from"./axios-47b9d439.js";import{_,a as d,b as u,c as D,d as t,e as l,s as g,i as b,j as v}from"./index-e9023bbb.js";const y="/assets/servicio-f21da5f7.jpeg",F={data(){return{authToken:null,formData:{fecha_inicio:"",fecha_fin:"",prioridad:"",folio_solicitud:null},prioridadOptions:[{label:"Alta",value:"alta"},{label:"Media",value:"media"},{label:"Baja",value:"baja"}],folio_Options:[]}},created(){this.obtenerToken()},methods:{obtenerToken(){const o={username:"admin",password:"secretaacces123"};c.post("https://api-constructora.onrender.com/token",{username:o.username,password:o.password},{headers:{"Content-Type":"application/json"}}).then(e=>{console.log(e),this.authToken=e.data.access_token,c.defaults.headers.common.Authorization=`Bearer ${this.authToken}`,this.cargarFolios()}).catch(e=>{console.error("Error al obtener el token JWT",e),e.response&&console.error("Respuesta del servidor:",e.response.data)})},cargarFolios(){this.authToken&&c.get(`https://api-constructora.onrender.com/solicitud_proyecto/ver-todas?jsonwebtoken=${this.authToken}`).then(o=>{this.folio_Options=o.data.map(e=>({label:e.folio_solicitud,value:e.folio_solicitud})),console.log(this.folio_Options)}).catch(o=>{console.error("Error al obtener los datos de la API",o)})},getMinFechaInicio(){const o=new Date,e=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),i=String(o.getDate()).padStart(2,"0");return`${e}-${s}-${i}`},getMaxFechaFin(){if(this.formData.fecha_inicio){const o=new Date(this.formData.fecha_inicio);o.setDate(o.getDate()+1800);const e=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),i=String(o.getDate()).padStart(2,"0");return`${e}-${s}-${i}`}return""},getCurrentDate(){const o=new Date,e=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),i=String(o.getDate()).padStart(2,"0");return`${e}-${s}-${i}`},submitForm(){console.log("Submit button clicked");const o=this.formatDate(this.formData.fecha_inicio),e=this.formatDate(this.formData.fecha_fin),s=`https://api-constructora.onrender.com/proyecto/create/?fecha_inicio=${o}&fecha_fin=${e}&prioridad=${this.formData.prioridad}&folio_solicitud=${this.formData.folio_solicitud}&jsonwebtoken=${this.authToken}`;c.post(s).then(i=>{i.status===200&&(this.showSuccessToast("¡Proyecto creado exitosamente!"),this.limpiarCamposEntrada())}).catch(i=>{console.error("Error al crear el Proyecto",i),this.showApiErrorToast(i)})},formatDate(o){const e={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(o).toLocaleDateString(void 0,e)},validateFields(){return this.formData.fecha_inicio&&this.formData.fecha_fin&&this.formData.prioridad&&this.formData.folio_solicitud?!0:(this.showValidationError("Por favor, complete todos los campos obligatorios."),!1)},showSuccessToast(o){this.$refs.toast.add({severity:"success",summary:"Éxito",detail:o,life:3e3})},showValidationError(o){this.$refs.toast.add({severity:"error",summary:"Error de validación",detail:o,life:5e3})},showApiErrorToast(o){console.error("Error en la API:",o),this.$refs.toast.add({severity:"error",summary:"Error al crear el proyecto",detail:"Fechas erroneas, folio incorrecto, la solicitud esta rechazada/en espera o el folio ya fue regsitrado.",life:5e3})},limpiarCamposEntrada(){this.formData.fecha_inicio="",this.formData.fecha_fin="",this.formData.prioridad="",this.formData.folio_solicitud=null}}},w=t("h1",null,"Registrar nuevo Proyecto",-1),S={class:"col-6 md:6"},V={class:"card p-fluid"},k={class:"field col-9 md-6"},T=t("label",{for:"fecha_inicio"},"Fecha de Inicio:",-1),x={class:"field col-9 md-6"},E=t("label",{for:"fecha_fin"},"Fecha de Fin:",-1),M={class:"field col-9 md-6"},B=t("label",{for:"prioridad"},"Prioridad:",-1),j={class:"field col-9 md-6"},I=t("label",{for:"estado_proyecto"},"Folio de solicitud",-1),O={class:"field col-5 md-3"},P=t("div",{class:"col-6 md:6"},[t("div",{class:"card p-fluid"},[t("img",{src:y,alt:"Logo representativo",style:{"max-width":"100%",height:"auto"}})])],-1);function A(o,e,s,i,a,n){const f=d("InputText"),m=d("Dropdown"),h=d("Button"),p=d("Toast");return u(),D("div",null,[w,t("form",{onSubmit:e[4]||(e[4]=v((...r)=>n.submitForm&&n.submitForm(...r),["prevent"])),class:"grid"},[t("div",S,[t("div",V,[t("div",k,[T,l(f,{id:"fecha_inicio",type:"date",modelValue:a.formData.fecha_inicio,"onUpdate:modelValue":e[0]||(e[0]=r=>a.formData.fecha_inicio=r),min:n.getMinFechaInicio(),max:n.getMaxFechaFin(),required:""},null,8,["modelValue","min","max"])]),t("div",x,[E,l(f,{id:"fecha_fin",type:"date",modelValue:a.formData.fecha_fin,"onUpdate:modelValue":e[1]||(e[1]=r=>a.formData.fecha_fin=r),min:a.formData.fecha_inicio,max:n.getMaxFechaFin(),required:"",disabled:!a.formData.fecha_inicio},null,8,["modelValue","min","max","disabled"])]),t("div",M,[B,l(m,{id:"prioridad",modelValue:a.formData.prioridad,"onUpdate:modelValue":e[2]||(e[2]=r=>a.formData.prioridad=r),options:a.prioridadOptions,optionLabel:"label",optionValue:"value",placeholder:"Seleccionar prioridad",required:""},null,8,["modelValue","options"])]),t("div",j,[I,a.folio_Options.length>0?(u(),g(m,{key:0,id:"folio_solicitud",modelValue:a.formData.folio_solicitud,"onUpdate:modelValue":e[3]||(e[3]=r=>a.formData.folio_solicitud=r),options:a.folio_Options,optionLabel:"label",optionValue:"value",placeholder:"Folio de solicitud",required:""},null,8,["modelValue","options"])):b("",!0)]),t("div",O,[l(h,{type:"submit",label:"Registrar",class:"p-button-success mr-2 mb-2"})])])]),P],32),l(p,{ref:"toast"},null,512)])}const q=_(F,[["render",A]]);export{q as default};
